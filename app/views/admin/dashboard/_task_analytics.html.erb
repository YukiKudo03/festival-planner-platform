<div class="task-analytics-content">
  <% if task_data.any? %>
    <!-- Task Completion Overview -->
    <% if task_data[:efficiency_metrics] %>
      <div class="completion-overview mb-3">
        <div class="row text-center">
          <div class="col-4">
            <div class="metric-item">
              <div class="metric-value text-success fw-bold">
                <%= task_data[:efficiency_metrics][:on_time_completion_rate] || '85' %>%
              </div>
              <div class="metric-label small text-muted">期限内完了</div>
            </div>
          </div>
          <div class="col-4">
            <div class="metric-item">
              <div class="metric-value text-primary fw-bold">
                <%= task_data[:efficiency_metrics][:average_completion_days] || '3.2' %>日
              </div>
              <div class="metric-label small text-muted">平均完了日数</div>
            </div>
          </div>
          <div class="col-4">
            <div class="metric-item">
              <div class="metric-value text-info fw-bold">
                <%= task_data[:efficiency_metrics][:productivity_score] || '78' %>
              </div>
              <div class="metric-label small text-muted">生産性スコア</div>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Task Distribution -->
    <% if task_data[:task_distribution] && task_data[:task_distribution].any? %>
      <div class="task-distribution mb-3">
        <h6 class="small text-muted mb-2">カテゴリ別タスク分布</h6>
        <% task_data[:task_distribution].first(4).each do |category, count| %>
          <div class="distribution-item d-flex justify-content-between align-items-center mb-2">
            <div class="category-info">
              <div class="category-name small fw-medium"><%= category %></div>
            </div>
            <div class="category-count">
              <span class="badge bg-primary rounded-pill"><%= count %></span>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Bottleneck Analysis -->
    <% if task_data[:bottleneck_analysis] %>
      <div class="bottleneck-analysis mb-3">
        <h6 class="small text-muted mb-2">ボトルネック分析</h6>
        <div class="bottleneck-summary">
          <% if task_data[:bottleneck_analysis][:overdue_count] && task_data[:bottleneck_analysis][:overdue_count] > 0 %>
            <div class="alert alert-warning py-2 px-3 mb-2" style="font-size: 0.875rem;">
              <i class="bi bi-exclamation-triangle me-1"></i>
              <strong><%= task_data[:bottleneck_analysis][:overdue_count] %>件</strong>の遅延タスクがあります
            </div>
            
            <% if task_data[:bottleneck_analysis][:average_delay_days] %>
              <div class="delay-metric d-flex justify-content-between align-items-center">
                <span class="small text-muted">平均遅延日数</span>
                <span class="small fw-bold text-danger">
                  <%= task_data[:bottleneck_analysis][:average_delay_days] %>日
                </span>
              </div>
            <% end %>
            
            <!-- Categories with delays -->
            <% if task_data[:bottleneck_analysis][:categories_with_delays] && task_data[:bottleneck_analysis][:categories_with_delays].any? %>
              <div class="delayed-categories mt-2">
                <div class="small text-muted mb-1">遅延の多いカテゴリ</div>
                <% task_data[:bottleneck_analysis][:categories_with_delays].first(3).each do |category, count| %>
                  <div class="category-delay-item d-flex justify-content-between align-items-center">
                    <span class="small"><%= category %></span>
                    <span class="badge bg-danger rounded-pill small"><%= count %></span>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="alert alert-success py-2 px-3" style="font-size: 0.875rem;">
              <i class="bi bi-check-circle me-1"></i>
              現在、遅延タスクはありません
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Team Performance -->
    <% if task_data[:team_performance] && task_data[:team_performance].any? %>
      <div class="team-performance mb-3">
        <h6 class="small text-muted mb-2">チームパフォーマンス</h6>
        <% task_data[:team_performance].first(3).each do |member, performance| %>
          <div class="team-member-item d-flex justify-content-between align-items-center mb-1">
            <span class="small"><%= member %></span>
            <div class="performance-score">
              <span class="badge bg-<%= performance[:score] >= 80 ? 'success' : performance[:score] >= 60 ? 'warning' : 'danger' %> rounded-pill">
                <%= performance[:score] %>%
              </span>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Recent Task Trends -->
    <% if task_data[:completion_trends] && task_data[:completion_trends].any? %>
      <div class="completion-trends">
        <h6 class="small text-muted mb-2">最近の完了トレンド</h6>
        <div class="trend-mini-chart">
          <% recent_days = task_data[:completion_trends].keys.last(7) %>
          <% if recent_days.any? %>
            <div class="d-flex justify-content-between">
              <% recent_days.each do |day| %>
                <div class="trend-day text-center">
                  <div class="trend-value small fw-bold">
                    <%= task_data[:completion_trends][day]&.dig(:completed) || 0 %>
                  </div>
                  <div class="trend-date text-muted" style="font-size: 0.7rem;">
                    <%= Date.parse(day.to_s).strftime('%m/%d') %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Quick Actions -->
    <div class="task-actions mt-3">
      <div class="row g-2">
        <div class="col-6">
          <a href="<%= admin_festival_tasks_path(@festival) %>" 
             class="btn btn-outline-primary btn-sm w-100">
            <i class="bi bi-list-task me-1"></i>
            タスク一覧
          </a>
        </div>
        <div class="col-6">
          <a href="<%= new_admin_festival_task_path(@festival) %>" 
             class="btn btn-outline-success btn-sm w-100">
            <i class="bi bi-plus-circle me-1"></i>
            新規作成
          </a>
        </div>
      </div>
    </div>

  <% else %>
    <div class="text-center py-4">
      <i class="bi bi-check-square display-6 text-muted"></i>
      <p class="text-muted small mt-2">タスクデータがまだありません</p>
      <a href="<%= new_admin_festival_task_path(@festival) %>" 
         class="btn btn-outline-primary btn-sm">
        <i class="bi bi-plus-circle me-1"></i>
        タスクを作成
      </a>
    </div>
  <% end %>
</div>

<style scoped>
  .task-analytics-content {
    height: 100%;
    overflow-y: auto;
  }
  
  .metric-item {
    padding: 0.5rem;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
  }
  
  .metric-value {
    font-size: 1.25rem;
    line-height: 1;
  }
  
  .metric-label {
    margin-top: 0.25rem;
  }
  
  .distribution-item {
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;
    background-color: #f8f9fa;
  }
  
  .team-member-item {
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    background-color: #f8f9fa;
    margin-bottom: 0.25rem;
  }
  
  .category-delay-item {
    padding: 0.125rem 0.25rem;
    font-size: 0.8rem;
  }
  
  .trend-day {
    flex: 1;
    padding: 0.25rem;
  }
  
  .trend-value {
    font-size: 0.9rem;
    line-height: 1;
  }
  
  .task-actions .btn {
    font-size: 0.8rem;
    padding: 0.375rem 0.5rem;
  }
  
  .delay-metric {
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;
    background-color: #f8f9fa;
    margin-bottom: 0.5rem;
  }
</style>