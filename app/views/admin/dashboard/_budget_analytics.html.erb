<div class="budget-analytics-content">
  <% if budget_data.any? %>
    <!-- Budget Utilization Summary -->
    <div class="budget-summary mb-3">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">予算使用率</span>
        <span class="fw-bold text-primary"><%= budget_data[:budget_utilization] %>%</span>
      </div>
      <div class="progress mb-3" style="height: 8px;">
        <div class="progress-bar bg-primary" 
             style="width: <%= budget_data[:budget_utilization] %>%"
             role="progressbar"></div>
      </div>
    </div>

    <!-- Top Expense Categories -->
    <div class="expense-categories mb-3">
      <h6 class="small text-muted mb-2">カテゴリ別支出</h6>
      <% if budget_data[:expense_breakdown].any? %>
        <% budget_data[:expense_breakdown].first(5).each do |category| %>
          <div class="category-item d-flex justify-content-between align-items-center mb-2">
            <div class="category-info">
              <div class="category-name small fw-medium"><%= category[:name] %></div>
              <div class="category-usage text-muted" style="font-size: 0.75rem;">
                使用率: <%= category[:utilization].round(1) %>%
              </div>
            </div>
            <div class="category-amount text-end">
              <div class="spent-amount small fw-bold">¥<%= number_with_delimiter(category[:spent]) %></div>
              <div class="budget-amount text-muted" style="font-size: 0.75rem;">
                / ¥<%= number_with_delimiter(category[:budget]) %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="text-muted small">まだ支出データがありません</p>
      <% end %>
    </div>

    <!-- Cash Flow Indicator -->
    <% if budget_data[:monthly_cash_flow].any? %>
      <div class="cash-flow-summary">
        <h6 class="small text-muted mb-2">月次キャッシュフロー</h6>
        <% latest_month = budget_data[:monthly_cash_flow].last %>
        <div class="cash-flow-item d-flex justify-content-between align-items-center">
          <span class="small text-muted">今月</span>
          <span class="fw-bold <%= latest_month[:net] >= 0 ? 'text-success' : 'text-danger' %>">
            <%= latest_month[:net] >= 0 ? '+' : '' %>¥<%= number_with_delimiter(latest_month[:net]) %>
          </span>
        </div>
        <div class="row text-center mt-2">
          <div class="col-6">
            <div class="small text-muted">収入</div>
            <div class="small fw-bold text-success">+¥<%= number_with_delimiter(latest_month[:revenue]) %></div>
          </div>
          <div class="col-6">
            <div class="small text-muted">支出</div>
            <div class="small fw-bold text-danger">-¥<%= number_with_delimiter(latest_month[:expense]) %></div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Budget vs Actual Alert -->
    <% if budget_data[:budget_vs_actual].any? %>
      <% over_budget = budget_data[:budget_vs_actual].select { |item| item[:variance] < 0 } %>
      <% if over_budget.any? %>
        <div class="alert alert-warning mt-3" style="padding: 0.5rem; font-size: 0.875rem;">
          <i class="bi bi-exclamation-triangle me-1"></i>
          <strong><%= over_budget.size %>カテゴリ</strong>で予算超過
        </div>
      <% end %>
    <% end %>

  <% else %>
    <div class="text-center py-4">
      <i class="bi bi-wallet2 display-6 text-muted"></i>
      <p class="text-muted small mt-2">予算データがまだありません</p>
    </div>
  <% end %>
</div>

<style scoped>
  .budget-analytics-content {
    height: 100%;
    overflow-y: auto;
  }
  
  .category-item {
    padding: 0.5rem;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
    margin-bottom: 0.5rem;
  }
  
  .category-item:hover {
    background-color: #e9ecef;
  }
  
  .cash-flow-item {
    padding: 0.5rem;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
  }
  
  .progress {
    background-color: #e9ecef;
  }
</style>