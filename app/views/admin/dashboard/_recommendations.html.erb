<div class="recommendations-content">
  <% if recommendations && recommendations.any? %>
    <div class="recommendations-list">
      <!-- Budget Recommendations -->
      <% if recommendations[:budget_recommendations] && recommendations[:budget_recommendations].any? %>
        <div class="recommendation-section mb-3">
          <h6 class="recommendation-category">
            <i class="bi bi-wallet2 text-warning me-2"></i>
            予算最適化
          </h6>
          <% recommendations[:budget_recommendations].first(3).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "予算配分の最適化" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "一部のカテゴリで予算が不足しています。予算の再配分を検討してください。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'High' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Task Recommendations -->
      <% if recommendations[:task_recommendations] && recommendations[:task_recommendations].any? %>
        <div class="recommendation-section mb-3">
          <h6 class="recommendation-category">
            <i class="bi bi-check-square text-success me-2"></i>
            タスク管理
          </h6>
          <% recommendations[:task_recommendations].first(3).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "タスクの優先順位見直し" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "遅延タスクがあります。リソースの再配分を検討してください。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'Medium' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Vendor Recommendations -->
      <% if recommendations[:vendor_recommendations] && recommendations[:vendor_recommendations].any? %>
        <div class="recommendation-section mb-3">
          <h6 class="recommendation-category">
            <i class="bi bi-shop text-primary me-2"></i>
            出店者管理
          </h6>
          <% recommendations[:vendor_recommendations].first(3).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "審査プロセスの改善" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "出店者の審査時間を短縮できる可能性があります。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'Low' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Venue Recommendations -->
      <% if recommendations[:venue_recommendations] && recommendations[:venue_recommendations].any? %>
        <div class="recommendation-section mb-3">
          <h6 class="recommendation-category">
            <i class="bi bi-geo-alt text-info me-2"></i>
            会場レイアウト
          </h6>
          <% recommendations[:venue_recommendations].first(3).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "レイアウトの最適化" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "人の流れを改善するため、レイアウトの調整を検討してください。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'Medium' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Communication Recommendations -->
      <% if recommendations[:communication_recommendations] && recommendations[:communication_recommendations].any? %>
        <div class="recommendation-section mb-3">
          <h6 class="recommendation-category">
            <i class="bi bi-chat-dots text-secondary me-2"></i>
            コミュニケーション
          </h6>
          <% recommendations[:communication_recommendations].first(3).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "参加促進施策" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "フォーラムの参加率を上げるため、トピック作成を促進してください。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'Low' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Process Improvements -->
      <% if recommendations[:process_improvements] && recommendations[:process_improvements].any? %>
        <div class="recommendation-section">
          <h6 class="recommendation-category">
            <i class="bi bi-gear text-dark me-2"></i>
            プロセス改善
          </h6>
          <% recommendations[:process_improvements].first(2).each do |recommendation| %>
            <div class="recommendation-item">
              <div class="recommendation-content">
                <div class="recommendation-title small fw-medium">
                  <%= recommendation[:title] || "ワークフロー最適化" %>
                </div>
                <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
                  <%= recommendation[:description] || "承認プロセスの自動化により効率を向上できます。" %>
                </div>
              </div>
              <div class="recommendation-priority">
                <span class="badge bg-<%= recommendation[:priority] == 'high' ? 'danger' : recommendation[:priority] == 'medium' ? 'warning' : 'secondary' %> rounded-pill">
                  <%= recommendation[:priority]&.humanize || 'Medium' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Action Button -->
    <div class="recommendations-actions mt-3 pt-3 border-top">
      <button class="btn btn-outline-primary btn-sm w-100" onclick="exportRecommendations()">
        <i class="bi bi-download me-1"></i>
        提案をエクスポート
      </button>
    </div>

  <% else %>
    <!-- Default Recommendations when no data -->
    <div class="default-recommendations">
      <div class="recommendation-section mb-3">
        <h6 class="recommendation-category">
          <i class="bi bi-lightbulb text-warning me-2"></i>
          一般的な最適化提案
        </h6>
        
        <div class="recommendation-item">
          <div class="recommendation-content">
            <div class="recommendation-title small fw-medium">
              定期的なデータ確認
            </div>
            <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
              週次でダッシュボードを確認し、トレンドの変化を把握しましょう。
            </div>
          </div>
          <div class="recommendation-priority">
            <span class="badge bg-info rounded-pill">Info</span>
          </div>
        </div>
        
        <div class="recommendation-item">
          <div class="recommendation-content">
            <div class="recommendation-title small fw-medium">
              コミュニケーション活性化
            </div>
            <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
              フォーラムやチャットの利用を促進し、チーム間の連携を強化しましょう。
            </div>
          </div>
          <div class="recommendation-priority">
            <span class="badge bg-secondary rounded-pill">Low</span>
          </div>
        </div>
        
        <div class="recommendation-item">
          <div class="recommendation-content">
            <div class="recommendation-title small fw-medium">
              予算管理の徹底
            </div>
            <div class="recommendation-description text-muted" style="font-size: 0.8rem;">
              各カテゴリの予算使用状況を定期的にチェックし、適切な配分を維持しましょう。
            </div>
          </div>
          <div class="recommendation-priority">
            <span class="badge bg-warning rounded-pill">Medium</span>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style scoped>
  .recommendations-content {
    max-height: 400px;
    overflow-y: auto;
  }
  
  .recommendation-section {
    border-left: 3px solid #dee2e6;
    padding-left: 1rem;
    margin-bottom: 1rem;
  }
  
  .recommendation-category {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: #495057;
  }
  
  .recommendation-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 0.75rem;
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    margin-bottom: 0.5rem;
    transition: background-color 0.2s ease;
  }
  
  .recommendation-item:hover {
    background-color: #e9ecef;
  }
  
  .recommendation-content {
    flex: 1;
    margin-right: 0.75rem;
  }
  
  .recommendation-title {
    line-height: 1.3;
    margin-bottom: 0.25rem;
  }
  
  .recommendation-description {
    line-height: 1.4;
  }
  
  .recommendation-priority {
    flex-shrink: 0;
  }
  
  .recommendations-actions {
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 0.5rem;
  }
  
  .badge {
    font-size: 0.7rem;
    padding: 0.25rem 0.5rem;
  }
</style>

<script>
  function exportRecommendations() {
    // 提案のエクスポート機能
    const recommendations = document.querySelector('.recommendations-content').innerText
    const blob = new Blob([recommendations], { type: 'text/plain' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `festival_recommendations_${new Date().toISOString().split('T')[0]}.txt`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
  }
</script>