# 地域のお祭り計画支援プラットフォーム - 現在の状況分析

## プロジェクト概要

### システム名
地域のお祭り計画支援プラットフォーム

### 目的
地域のお祭りの企画・準備・運営・振り返りの全工程を統合的に支援するWebベースのシステム

### 対象ユーザー
- 実行委員会メンバー
- 地域住民・ボランティア
- 出店者（ベンダー）
- 来場者
- システム管理者
- プラットフォーム閲覧者

## 技術スタック

### フレームワーク・言語
- **Ruby on Rails 8.0.2** - メインフレームワーク
- **PostgreSQL** - データベース
- **Ruby** - バックエンド言語

### フロントエンド技術
- **Bootstrap 5.3** - UIフレームワーク
- **jQuery** - JavaScript ライブラリ
- **Stimulus** - Hotwire JavaScript フレームワーク
- **Turbo Rails** - SPA風のページ遷移
- **Dart Sass** - CSSプリプロセッサ
- **Importmap** - ES modules管理

### 認証・認可
- **Devise** - ユーザー認証
- **CanCanCan** - 認可・権限管理

### その他の主要gem
- **Propshaft** - アセットパイプライン
- **Puma** - Webサーバー
- **Solid Cache/Queue/Cable** - Rails 8の新機能
- 
- **Image Processing** - 画像処理
- **Kamal** - デプロイメント
- **Thruster** - HTTP最適化

## 現在のデータベース構造

### Users テーブル
- 基本情報: email, encrypted_password, first_name, last_name, phone, bio
- Devise機能: reset_password_token, remember_created_at等
- **役割（role）**: resident, volunteer, vendor, committee_member, admin, system_admin, platform_visitor

### Festivals テーブル
- 基本情報: name, description, location, budget
- 日程: start_date, end_date
- **ステータス**: planning, preparation, active, completed, cancelled
- 関連: user_id（作成者）

### Tasks テーブル
- 基本情報: title, description, due_date
- **優先度**: low, medium, high, urgent
- **ステータス**: pending, in_progress, completed, cancelled
- 関連: user_id（担当者）, festival_id

### Vendor Applications テーブル
- 出店申請情報: business_name, business_type, description, requirements
- **ステータス**: （enumで管理、詳細は未確認）
- 関連: festival_id, user_id

## 実装済み機能（推測）

### 1. ユーザー管理
- ✅ Deviseによる認証機能
- ✅ 役割ベースの権限管理（7つの役割）
- ✅ ユーザープロフィール管理

### 2. お祭り管理
- ✅ お祭りの作成・編集・削除
- ✅ お祭りステータス管理（5段階）
- ✅ 進捗率計算機能
- ✅ 期間計算機能

### 3. タスク管理
- ✅ タスクの作成・管理
- ✅ 優先度・ステータス管理
- ✅ 期限管理（期限切れ・間近の検出）
- ✅ お祭り期間との関連チェック

### 4. 出店者管理
- ✅ 出店申請機能
- ✅ 申請ステータス管理
- ✅ お祭りとベンダーの関連管理

## 現在のファイル構造

### Controllers
- ApplicationController, AdminController
- FestivalsController, TasksController
- VendorApplicationsController
- PublicFestivalsController（公開ページ用）
- HomeController, ErrorsController

### Views
- Devise認証画面一式
- Festivals（お祭り管理画面）
- Tasks（タスク管理画面）
- VendorApplications（出店申請画面）
- PublicFestivals（公開ページ）
- Admin（管理画面）
- Error pages（404, 500等）

### JavaScript
- Stimulus controllers（dropdown, navigation, sidebar等）
- Bootstrap設定
- フォームバリデーション

## 要件との実装状況比較

### ✅ 実装済み（推測）
1. **基本的なプロジェクト管理** - お祭り・タスク管理
2. **ユーザー・権限管理** - Devise + CanCanCan
3. **出店者管理の基本** - 申請機能
4. **基本的なUI** - Bootstrap + Stimulus

### ❓ 部分実装（要確認）
1. **スケジュール管理** - タスクの期限管理はあるが、詳細なスケジュール機能は不明
2. **コミュニケーション機能** - 実装状況不明
3. **モバイル対応** - Bootstrap使用でレスポンシブ対応はあると思われる

### ❌ 未実装（推測）
1. **会場・レイアウト管理** - データベース構造になし
2. **予算・収支管理** - budgetフィールドはあるが詳細管理は未実装
3. **告知・PR管理** - 関連テーブルなし
4. **申請・許可管理** - 汎用的な申請管理機能なし
5. **レポート・分析機能** - 実装形跡なし
6. **ファイル共有機能** - Active Storage設定は不明
7. **通知機能** - 実装形跡なし

## 開発環境の状況

### 設定ファイル
- Docker対応（Dockerfile存在）
- Kamalによるデプロイ設定
- 開発・テスト・本番環境の設定ファイル完備

### テスト環境
- Test fixtures設定済み
- System test（Capybara + Selenium）設定済み
- Controller、Model、Helper のテストファイル生成済み

### 品質管理
- Rubocop（Rails Omakase）設定
- Brakeman（セキュリティ検査）設定
- Debug gem設定

## 次の開発ステップの推奨

### 優先度 High
1. **現在の実装の動作確認** - サーバー起動、基本機能テスト
2. **テストの実行** - 既存機能の品質確認
3. **未実装の基本機能** - 会場管理、予算管理等のMVP機能

### 優先度 Medium  
4. **コミュニケーション機能** - 掲示板、通知等
5. **レポート機能** - 進捗レポート、分析機能
6. **ファイル管理** - Active Storage設定、ファイル共有

### 優先度 Low
7. **高度な機能** - QRコード、外部API連携等
8. **パフォーマンス最適化**
9. **本格的なデプロイ設定**

## リスク・注意点

1. **スコープの大きさ** - 要件が非常に大規模で、6ヶ月での完成は挑戦的
2. **複雑な権限管理** - 7つの役割と細かい権限設定が必要
3. **データの整合性** - お祭り、タスク、ユーザーの複雑な関係性
4. **セキュリティ要件** - 個人情報保護、多要素認証等の高いセキュリティ要件

## 総評

基本的なMVP（Minimum Viable Product）の骨組みは構築済み。Ruby on Rails 8の最新機能を活用した現代的な技術スタックで、拡張性の高い設計。ただし、要件で求められている機能の多くがまだ未実装で、特に会場管理、予算管理、コミュニケーション機能等の重要な機能が不足している状況。

現在の実装レベル: **約20-30%** （基本的なCRUD機能とユーザー管理が中心）